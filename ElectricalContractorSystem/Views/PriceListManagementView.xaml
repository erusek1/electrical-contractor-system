<Window x:Class="ElectricalContractorSystem.Views.PriceListManagementView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Price List Management" Height="700" Width="1200">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#2C3E50" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Text="Price List Management" FontSize="20" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                
                <Button Grid.Column="1" Content="Add Item" Command="{Binding AddItemCommand}" 
                        Style="{StaticResource PrimaryButtonStyle}" Margin="5,0"/>
                <Button Grid.Column="2" Content="Import from Excel" Command="{Binding ImportFromExcelCommand}" 
                        Style="{StaticResource SecondaryButtonStyle}" Margin="5,0"/>
                <Button Grid.Column="3" Content="Export to Excel" Command="{Binding ExportToExcelCommand}" 
                        Style="{StaticResource SecondaryButtonStyle}" Margin="5,0"/>
                <Button Grid.Column="4" Content="Update All Prices" Command="{Binding UpdateAllPricesCommand}" 
                        Style="{StaticResource AccentButtonStyle}" Margin="5,0"/>
            </Grid>
        </Border>
        
        <!-- Search and Filter Bar -->
        <Border Grid.Row="1" Background="#ECF0F1" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                         VerticalAlignment="Center" Padding="5"/>
                
                <TextBlock Grid.Column="2" Text="Category:" VerticalAlignment="Center" Margin="20,0,10,0"/>
                <ComboBox Grid.Column="3" ItemsSource="{Binding Categories}" 
                          SelectedItem="{Binding SelectedCategory}"
                          VerticalAlignment="Center"/>
                
                <CheckBox Grid.Column="4" Content="Active Only" IsChecked="{Binding ShowActiveOnly}" 
                          VerticalAlignment="Center" Margin="20,0"/>
                
                <Button Grid.Column="5" Content="Clear Filters" Command="{Binding ClearFiltersCommand}" 
                        Margin="20,0,0,0" Padding="10,5"/>
            </Grid>
        </Border>
        
        <!-- Price List Grid -->
        <DataGrid Grid.Row="2" ItemsSource="{Binding FilteredItems}" 
                  SelectedItem="{Binding SelectedItem}"
                  AutoGenerateColumns="False" CanUserAddRows="False"
                  Margin="10">
            <DataGrid.Resources>
                <Style TargetType="DataGridCell">
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="{x:Null}"/>
                            <Setter Property="BorderBrush" Value="{x:Null}"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.Resources>
            
            <DataGrid.Columns>
                <DataGridTextColumn Header="Code" Binding="{Binding ItemCode}" Width="80"/>
                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="120"/>
                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="250"/>
                <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                <DataGridTextColumn Header="Base Cost" Binding="{Binding BaseCost, StringFormat=C}" Width="80"/>
                <DataGridTextColumn Header="Tax %" Binding="{Binding TaxRate, StringFormat={}{0:P1}}" Width="60"/>
                <DataGridTextColumn Header="Sell Price" Binding="{Binding SellPrice, StringFormat=C}" Width="80" IsReadOnly="True"/>
                <DataGridTextColumn Header="Rough Min" Binding="{Binding LaborRough}" Width="70"/>
                <DataGridTextColumn Header="Finish Min" Binding="{Binding LaborFinish}" Width="70"/>
                <DataGridTextColumn Header="Service Min" Binding="{Binding LaborService}" Width="70"/>
                <DataGridTextColumn Header="Extra Min" Binding="{Binding LaborExtra}" Width="70"/>
                <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="50"/>
                
                <DataGridTemplateColumn Header="Actions" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="Save" Command="{Binding DataContext.SaveItemCommand, 
                                        RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource SmallButtonStyle}" Margin="2"/>
                                <Button Content="Delete" Command="{Binding DataContext.DeleteItemCommand, 
                                        RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        Style="{StaticResource DeleteButtonStyle}" Margin="2"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock>
                    <TextBlock.Text>
                        <MultiBinding StringFormat="Total Items: {0} | Active: {1}">
                            <Binding Path="Items.Count"/>
                            <Binding Path="ActiveItemCount"/>
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>